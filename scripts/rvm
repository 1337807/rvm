#!/usr/bin/env bash

#
# rvm : Ruby Version Manager
# http://rvm.beginrescueend.com
# http://gitub.com/wayneeseguin/rvm
#

if [[ -f /etc/rvmrc ]] ; then source /etc/rvmrc ; fi
if [[ -f "$HOME/.rvmrc" ]] ; then source "$HOME/.rvmrc" ; fi

if [[ -s "${rvm_path:-$HOME/.rvm}/scripts/initialize" ]] ; then
  source "${rvm_path:-$HOME/.rvm}/scripts/initialize"
elif [[ -s "/usr/local/rvm/scripts/initialize" ]] ; then
  source "/usr/local/rvm/scripts/initialize"
fi

source $rvm_scripts_path/utility
source $rvm_scripts_path/selector
source $rvm_scripts_path/ruby-installer # TODO: Script not function.
source $rvm_scripts_path/cli
source $rvm_scripts_path/gems

rvm_loaded_flag=1 ; export rvm_loaded_flag

rvm_version="$(cat "${rvm_path}/lib/VERSION.yml" | tail -n 3 | sed 's/^.*: //g' | tr "\n" '.' | sed 's/\.$//')" ; export rvm_version

alias rvm-restart="source \"${rvm_path}/scripts/rvm\""

if [[ -f "$rvm_path/default" ]] ; then source "$rvm_path/default" ; fi

# Source a .rvmrc file in a directory after changing to it, if it exists.
cd() { builtin cd "$@" ; if [[ -f .rvmrc ]] ; then source .rvmrc ; fi ; }

# Ok now we determine if we were called or sourced... under assumption of course ;)
if [[ $# -gt 0 ]] && [[ -z "$(echo "$*" | awk '/completion-/')" ]] ; then rvm "$*" ; fi

